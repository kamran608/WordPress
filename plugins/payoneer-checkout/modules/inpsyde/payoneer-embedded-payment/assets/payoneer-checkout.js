!function(){"use strict";var e={20:function(e,t,n){var o=n(609),a=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),r=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var o,i={},d=null,l=null;for(o in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,o)&&!c.hasOwnProperty(o)&&(i[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===i[o]&&(i[o]=t[o]);return{$$typeof:a,type:e,key:d,ref:l,props:i,_owner:r.current}}},609:function(e){e.exports=window.React},848:function(e,t,n){e.exports=n(20)}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};n.r(o),n.d(o,{addComponentToContainer:function(){return R},initPayoneerComponents:function(){return V},mountComponents:function(){return x},onBeforeError:function(){return T},onComponentListChange:function(){return A},onPaymentDeclined:function(){return C},onPaymentFailure:function(){return P},onValidationInfo:function(){return b},pay:function(){return v},reboot:function(){return U},registerComponent:function(){return F},releaseOnHoldOrder:function(){return M},removeComponentFromContainer:function(){return L},setActivePaymentMethod:function(){return I},setEnv:function(){return w},setForceHostedFlow:function(){return O},setIsMounted:function(){return K},setIsReady:function(){return $},setIsValid:function(){return j},setLongId:function(){return f},setOnPaymentUnsuccessfulNonce:function(){return D},setOrderId:function(){return N},setSdkState:function(){return _},unmountAllComponents:function(){return Y},unregisterComponent:function(){return H}});var a={};n.r(a),n.d(a,{getEnv:function(){return Q},getExtensionData:function(){return z},getLongId:function(){return J},getSdk:function(){return X},getSdkIntegrity:function(){return ee},getSdkVersion:function(){return Z}});var s=window.jQuery,r=n.n(s);const{paymentFieldsComponentAttribute:c}=window.PayoneerData,i=()=>document.querySelector('.woocommerce-checkout input[name="payment_method"]:checked'),d=()=>{return t=null!==(e=i()?.id)&&void 0!==e?e:"",/^payment_method_payoneer-(checkout|afterpay|klarna|affirm|bancontact|eps|ideal|multibanco|p24)/i.test(t);var e,t},l=()=>"1"===window.PayoneerData.isPayForOrder,u=()=>{i()?.focus()};var p=window.wp.data;const y={SET_EXTENSION_DATA:"SET_EXTENSION_DATA",SET_LONG_ID:"SET_LONG_ID",SET_LIST_URL:"SET_LIST_URL",SET_ENV:"SET_ENV",SET_SDK:"SET_SDK",SET_SDK_VERSION:"SET_SDK_VERSION",SET_SDK_INTEGRITY:"SET_SDK_INTEGRITY",SET_SDK_STATE:"SET_SDK_STATE",PAY:"PAY",SET_ACTIVE_PAYMENT_METHOD:"SET_ACTIVE_PAYMENT_METHOD",SET_FORCE_HOSTED_FLOW:"SET_FORCE_HOSTED_FLOW",SET_ORDER_ID:"SET_ORDER_ID",SET_ON_PAYMENT_UNSUCCESSFUL_NONCE:"SET_ON_PAYMENT_UNSUCCESSFUL_NONCE",ADD_COMPONENT:"ADD_COMPONENT",REMOVE_COMPONENT:"REMOVE_COMPONENT",SET_IS_VALID:"SET_IS_VALID",SET_IS_MOUNTED:"SET_IS_MOUNTED",SET_IS_READY:"SET_IS_READY",MOUNT_COMPONENTS:"MOUNT_COMPONENTS"},m={activePaymentMethod:"",longId:null,env:null,sdkState:"UNINITIALIZED",forceHostedFlow:!0,components:{}},h=(e,t,n)=>{const o=e.components[t]||{};return{...e.components,[t]:{key:t,instance:o.instance||null,isMounted:o.isMounted||!1,isReady:o.isReady||!1,isValid:o.isValid||!1,...n}}};var S=window.wp.hooks;const{paymentFieldsComponentAttribute:g}=window.PayoneerData,E=e=>({"payoneer-checkout":"cards","payoneer-afterpay":"afterpay","payoneer-klarna":"klarna","payoneer-affirm":"affirm","payoneer-bancontact":"bancontact","payoneer-eps":"eps","payoneer-ideal":"ideal","payoneer-multibanco":"multibanco","payoneer-p24":"p24"}[e]),k=(...e)=>console.log("[action]",...e),f=e=>async({select:t,resolveSelect:n,dispatch:o})=>{const a=await n.getSdk();await a.updateLongId(e),o({type:y.SET_LONG_ID,payload:e})},_=e=>({type:y.SET_SDK_STATE,payload:e});function w(e){return{type:y.SET_ENV,payload:e}}const v=()=>({select:e,dispatch:t})=>{const{instance:n}=e.getActiveComponent();n?n.pay?(k("pay -",n),n.pay()):k("Component does not have a pay method.",n):k("Component not found.")},T=(e,t,n)=>async({select:o,dispatch:a})=>(console.error("callback: onBeforeError -",{sdk:e,component:t,data:n}),a.setSdkState(e.state),["SYSTEM_FAILURE"].includes(n?.interaction?.reason)?(a.setForceHostedFlow(!0),!0):S.defaultHooks.applyFilters("payoneer.webSdk.onSdkError",!1,e,t,n)),C=(e,t,n)=>async({select:o,dispatch:a})=>(k("callback: onPaymentDeclined -",t,n),S.defaultHooks.applyFilters("payoneer.webSdk.onPaymentDeclined",!0,e,t,n)),P=(e,t,n)=>async({select:o,dispatch:a})=>(k("callback: onPaymentFailure -",t,n),S.defaultHooks.applyFilters("payoneer.webSdk.onPaymentFailure",!0,e,t,n)),b=(e,t,n)=>async({select:e,dispatch:o})=>{k("callback: onValidationInfo -",t,n);const a=((e,t)=>{var n;return"card"===(e=null!==(n=t.methodName)&&void 0!==n?n:e)?"cards":e})(t,n);o.setIsValid(a,n.valid),o.setIsReady(a,!0)},I=e=>async({dispatch:t})=>{k("setActivePaymentMethod -",e),t.mountComponents(),t({type:y.SET_ACTIVE_PAYMENT_METHOD,payload:e})};function O(e){return k("setForceHostedFlow - override state:",e),{type:y.SET_FORCE_HOSTED_FLOW,payload:e}}const D=e=>({dispatch:t})=>{t({type:y.SET_ON_PAYMENT_UNSUCCESSFUL_NONCE,payload:e})},N=e=>({dispatch:t})=>{t({type:y.SET_ORDER_ID,payload:e})},M=e=>async({dispatch:t})=>{k("releaseOnHoldOrder -",e);const n=window.wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","payoneer-checkout-payment-unsuccessful"),o=n.includes("?")?"&":"?",a=n+o+"_ajax_nonce="+window.PayoneerData.onPaymentUnsuccessfulNonce;return new Promise((n,o)=>{r().ajax({type:"POST",url:a,xhrFields:{withCredentials:!0},data:e,dataType:"json"}).success(e=>{t.setOnPaymentUnsuccessfulNonce(e.nonce),n(e)}).catch(e=>{console.error(e),o(e)})})},A=(e,t)=>async({select:n,dispatch:o})=>{k("callback: onComponentListChange",e,t),t.addedComponents.forEach(e=>{o.addComponentToContainer(e)}),t.removedComponents.forEach(e=>{o.removeComponentFromContainer(e)})},R=e=>async({select:t,resolveSelect:n,dispatch:o})=>{const a=await n.getSdk();if(!a.isDroppedIn(e))try{const t=a.dropIn(e,{hidePaymentButton:!0});o.registerComponent(e,t)}catch(t){console.error(`Failed to drop in component ${e}. Error details: ${t}`)}const{instance:s}=t.getComponentByName(e);B(e,s,a,o)},L=e=>async({select:t,resolveSelect:n,dispatch:o})=>{o.unregisterComponent(e)},F=(e,t)=>({type:y.ADD_COMPONENT,payload:{componentName:e,instance:t}}),H=e=>({type:y.REMOVE_COMPONENT,payload:{componentName:e}}),V=()=>async({select:e,resolveSelect:t,dispatch:n})=>{k("initPayoneerComponents");const o=await t.getSdk(),a=await t.getLongId();await o.updateLongId(a),await n.mountComponents()},U=()=>async({select:e,resolveSelect:t,dispatch:n})=>{k("reboot"),n.unmountAllComponents(),S.defaultHooks.doAction("payoneer.webSdk.reboot"),wp.data.dispatch("wc/store/cart").invalidateResolutionForStore(),n.invalidateResolutionForStore(),await n.mountComponents()},x=()=>async({select:e,resolveSelect:t,dispatch:n})=>{k("mountComponents"),n.unmountAllComponents();const o=await t.getSdk(),a=e.getAllComponents();Object.entries(a).forEach(async([e,t])=>{B(e,t.instance,o,n)})},B=(e,t,n,o)=>{((e,t,n)=>{if(!t||!n.isAvailable(e))return;const o=function(e){return document.querySelector(`[${g}=${e}]`)}(e);o instanceof Element&&(console.log("mountSdkComponent:",e,t),t.mount(o))})(e,t,n),o.setIsMounted(e,!0),(e=>e.element instanceof Element&&e.element.id.includes("redirect"))(t)&&(k("mark redirect component as valid and ready -",e),o.setIsReady(e,!0),o.setIsValid(e,!0))},Y=()=>({select:e,dispatch:t})=>{const n=e.getAllComponents();Object.keys(n).forEach(e=>{t.setIsMounted(e,!1)})},j=(e,t)=>({type:y.SET_IS_VALID,payload:{componentName:e,flag:t}}),K=(e,t=!0)=>({type:y.SET_IS_MOUNTED,payload:{componentName:e,flag:t}}),$=(e,t)=>({type:y.SET_IS_READY,payload:{componentName:e,flag:t}});var G=window.wp.apiFetch,W=n.n(G);const{websdkStyles:q}=PayoneerData,X=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getEnv(),o=await e.getSdkVersion(),a=await e.getSdkIntegrity(),s=await e.getLongId(),r=await(c={env:n,sdkVersion:o,sdkIntegrity:a,onBeforeError:async(e,n,o)=>await t.onBeforeError(e,n,o),onPaymentDeclined:async(e,n,o)=>await t.onPaymentDeclined(e,n,o),onPaymentFailure:async(e,n,o)=>await t.onPaymentFailure(e,n,o),onComponentListChange:async(e,n)=>await t.onComponentListChange(e,n),onValidationInfo:async(e,n,o)=>await t.onValidationInfo(e,n,o),preload:["stripe:cards"],styles:q,refetchListBeforeCharge:!0},window.Payoneer?.CheckoutWeb?window.Payoneer.CheckoutWeb(c):new Promise((e,t)=>{const n=document.createElement("script");n.src=((e,t)=>{const n=t?`-${t}`:"";return new URL(window.PayoneerData.webSdkUmdUrlTemplate?.replace("<env>",e)?.replace("<version>",n))})(c.env,c.sdkVersion),n.onload=e,n.onerror=t,c.sdkVersion&&c.sdkIntegrity&&(n.integrity=c.sdkIntegrity,n.crossOrigin="anonymous"),document.head.appendChild(n)}).then(()=>window.Payoneer.CheckoutWeb(c)));var c;if("LOADING"===r.state){const e=async()=>await new Promise(e=>{const t=setInterval(()=>{"LOADING"!==r.state&&(e(r.state),clearInterval(t))},1e3)});await e()}await r.updateLongId(s),await t.setForceHostedFlow(!1),await t.setSdkState(r.state),await t({type:y.SET_SDK,payload:r})},z=()=>async({dispatch:e})=>{const t=await W()({path:"/wc/store/v1/cart#skipPreloadingMiddleware",method:"GET",cache:"no-store",parse:!1}),n=(await t.json()).extensions["payoneer-checkout"];console.log("Payoneer Extension Data: ",n),await e({type:y.SET_EXTENSION_DATA,payload:n}),S.defaultHooks.doAction("payoneer.checkout.onReceiveExtensionData",n)},J=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_LONG_ID,payload:n.longId})},Q=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_ENV,payload:n.environment})},Z=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_SDK_VERSION,payload:n.sdkVersion})},ee=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_SDK_INTEGRITY,payload:n.sdkIntegrity})};var te={getExtensionData:e=>e.extension,getLongId:e=>e.longId,getEnv:e=>e.env,getSdkVersion:e=>e.sdkVersion,getSdkIntegrity:e=>e.sdkIntegrity,getSdk:e=>e.sdk,isHostedModeForced:e=>e.forceHostedFlow,getActivePaymentMethod:e=>e.activePaymentMethod,getOrderId:e=>e.orderId,getOnPaymentUnsuccessfulNonce:e=>e.onPaymentUnsuccessfulNonce,getAllComponents:e=>e.components,getComponentByName:(e,t)=>{var n;return null!==(n=e.components[t])&&void 0!==n?n:{}},getActiveComponent:e=>{var t;const n=E(e.activePaymentMethod);return null!==(t=e.components[n])&&void 0!==t?t:{}}};const ne="payoneer-checkout",oe=(0,p.createReduxStore)(ne,{reducer:(e=m,{type:t,payload:n})=>{switch(t){case y.SET_EXTENSION_DATA:return{...e,extension:n};case y.SET_LONG_ID:return{...e,longId:n};case y.SET_LIST_URL:return{...e,listUrl:n};case y.SET_ENV:return{...e,env:n};case y.SET_SDK:return{...e,sdk:n};case y.SET_SDK_VERSION:return{...e,sdkVersion:n};case y.SET_SDK_INTEGRITY:return{...e,sdkIntegrity:n};case y.SET_SDK_STATE:return{...e,sdkState:n};case y.SET_ACTIVE_PAYMENT_METHOD:return{...e,activePaymentMethod:n};case y.SET_FORCE_HOSTED_FLOW:return{...e,forceHostedFlow:n};case y.SET_ORDER_ID:return{...e,orderId:n};case y.SET_ON_PAYMENT_UNSUCCESSFUL_NONCE:return{...e,onPaymentUnsuccessfulNonce:n};case y.ADD_COMPONENT:return{...e,components:h(e,n.componentName,{instance:n.instance})};case y.REMOVE_COMPONENT:{const{[n.componentName]:t,...o}=e.components;return{...e,components:o}}case y.SET_IS_VALID:return{...e,components:h(e,n.componentName,{isValid:n.flag})};case y.SET_IS_MOUNTED:return{...e,components:h(e,n.componentName,{isMounted:n.flag})};case y.SET_IS_READY:return{...e,components:h(e,n.componentName,{isReady:n.flag})};default:return e}},actions:o,selectors:te,resolvers:a});(0,p.register)(oe);const ae="x-payoneer-checkout-force-hosted-flow",se="x-payoneer-is-payment-checkout",re=()=>{const e={[ae]:String((0,p.select)(ne).isHostedModeForced()),[se]:l&&new URLSearchParams(window.location.search).get("key")||""};return S.defaultHooks.applyFilters("payoneer.http.customHeaders",e)};S.defaultHooks.addAction("payoneer.checkout.onReceiveExtensionData","payoneer/setupCustomHttpHeaders",()=>{S.defaultHooks.addFilter("payoneer.http.customHeaders","payoneer/setupCustomHttpHeaders",function(e){return e["x-payoneer-long-id"]=String((0,p.select)(ne).getLongId()),e})});var ce=window.wc.wcBlocksData;const ie=()=>{const e=function(){const e=null!==(t=i()?.value)&&void 0!==t?t:"";var t;(0,p.dispatch)(ne).setActivePaymentMethod(e)};jQuery(document.body).on("payment_method_selected",e),e(),de()},de=()=>{const e=["key","isValid","isMounted","isReady"],t=(0,p.select)(ne),n={};let o=null;const a=(...e)=>console.log("[componentObserver]",...e),s=r=>{const c=(()=>{const o=t.getActiveComponent();return a=o,!!e.some(e=>n[e]!==a[e])&&((t=>{e.forEach(e=>n[e]=t[e])})(o),!0);var a})();(c||0!==r)&&(c&&r<10?o=setTimeout(s,25,r+1):(a("active payment component changed -",n),"klarna"===n?.key&&setTimeout(()=>(0,p.dispatch)(ne).setIsReady(n.key,!0),3e3),S.defaultHooks.doAction("payoneer.checkout.paymentMethodChanged",{...n}),o=null))};return a("subscribe to store changes"),e.forEach(e=>n[e]=null),{unsubscribe:(0,p.subscribe)(()=>{null===o&&s(0)},ne)}},le="payoneer-checkout-payment-allowed",ue="payoneer-checkout-payment-data-invalid",pe="payoneer-checkout-payment-not-ready";var ye=class{#e="";#t=null;#n=null;#o={active:!0,processing:!1,valid:!1};constructor(e=".form-row.place-order"){this.#e=e,this.#a("initialized"),this.#s()}get area(){return r()(this.#e)}get button(){return this.area.find("#place_order")}get isPaymentAllowed(){const{active:e,valid:t,processing:n}=this.#o;return!e||t&&!n}get isAreaBlocked(){return!!this.area.data("blockUI.isBlocked")}get isButtonDisabled(){return this.button.prop("disabled")}get validPaymentInput(){return this.#o.valid}setValidInput(e){this.#o.valid=e,this.#s()}setProcessing(e=!0){e?this.#o.processing=!0:(this.#n=null,this.#o.processing=!1),this.#s()}setProcessingMessage(e){this.#n=e,this.#s()}setActive(e){this.#o.active=e,this.#s()}#s(){const{active:e,valid:t,processing:n}=this.#o;return e?n?(this.#r(pe),void this.#c()):(this.#i(),void(t?(this.#r(le),this.#d()):(this.#r(ue),this.#l()))):(this.#i(),this.#d(),void this.#r(null))}#r(e){const t=[le,ue,pe];t.forEach(e=>{document.body.classList.remove(e)}),e&&t.includes(e)&&document.body.classList.add(e)}#c(){if("function"!=typeof r().fn.block)return;const e={message:this.#n,overlayCSS:{background:"#fff",opacity:.6}};this.#n&&(e.blockMsgClass="no-spinner",e.css={maxWidth:"80%",width:"auto",cursor:"default"}),this.isAreaBlocked&&(e.fadeIn=0),this.#u(),this.area.block(e),this.#a("ðŸ”’ area blocked (spinner)")}#i(){this.isAreaBlocked&&"function"==typeof r().fn.unblock&&(this.#p(),this.area.unblock(),this.#a("ðŸ”“ area unblocked"))}#l(){this.isButtonDisabled||(this.button.prop("disabled",!0).addClass("disabled"),this.#a("âŒ button disabled"))}#d(){this.isButtonDisabled&&(this.button.prop("disabled",!1).removeClass("disabled"),this.#a("âœ… button enabled"))}#u(){this.#t||(this.#t=document.createElement("style"),this.#t.textContent=this.#y(),document.head.appendChild(this.#t),this.#a("ðŸŽ¨ blocking CSS injected"))}#p(){this.#t&&(this.#t.remove(),this.#t=null,this.#a("ðŸŽ¨ blocking CSS removed"))}#y(){const e=this.#e;return`\n\t\t\t${e} .place-order {\n\t\t\t\tpointer-events: none !important;\n\t\t\t}\n\t\t\t${e} #place_order {\n\t\t\t\topacity: 0.5 !important;\n\t\t\t\tpointer-events: none !important;\n\t\t\t}\n\t\t\t.blockUI.no-spinner:before {\n\t\t\t\tdisplay: none !important;\n\t\t\t}\n\t\t\t.blockUI.no-spinner button {\n\t\t\t\tdisplay: block;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t`}#a(e){const{active:t,valid:n,processing:o}=this.#o;console.log(`[OrderPlacement] ${e} | A:${t} V:${n} P:${o}`)}};const me=(...e)=>console.log("[classic checkout]",...e),he=e=>(0,p.dispatch)(ne).releaseOnHoldOrder(e),Se=(0,p.select)(ne);var ge=n(609),Ee=n(848);const ke=()=>(0,p.dispatch)(ne).initPayoneerComponents(),fe=()=>(0,p.dispatch)(ne).pay(),_e=()=>(0,p.dispatch)(ne).reboot(),we=(0,p.withSelect)((e,t)=>{const n=e(ne),{activePaymentMethod:o,eventRegistration:a}=t,s=E(o),{isValid:r,isReady:c}=n.getComponentByName(s);return{activePaymentMethod:o,eventRegistration:a,canMakePayment:c&&r,componentName:s,initPayoneerComponents:ke,rebootPayoneer:_e,payWithPayoneer:fe}})(function({activePaymentMethod:e,eventRegistration:t,componentName:n,paymentMethodData:o,canMakePayment:a,initPayoneerComponents:s,rebootPayoneer:r,payWithPayoneer:c}){const{onPaymentSetup:i,onCheckoutSuccess:d,onCheckoutFail:l}=t;return(0,ge.useEffect)(()=>{s()},[]),(0,ge.useEffect)(()=>d(({orderId:e})=>{(0,p.dispatch)(ne).setOrderId(e),c()}),[]),(0,ge.useEffect)(()=>l(r),[]),(0,ge.useEffect)(()=>i(()=>a?{type:"success"}:{type:"failure",message:"Invalid payment fields"}),[a,i,o]),(0,Ee.jsx)("div",{className:`payment_method_${e}`,"data-component":n})}),ve=(0,p.select)(ne),Te="payoneer-checkout-error-message",Ce=(...e)=>console.log("[payment page]",...e),Pe=e=>(0,p.dispatch)(ne).releaseOnHoldOrder(e),be=(0,p.select)(ne);document.addEventListener("DOMContentLoaded",async()=>{const e=window.fetch;if(window.fetch=async(...t)=>{let[n,o]=t;if(new URL(n,window.location.origin).origin!==window.location.origin)return e(n,o);const a=re();return console.log("Adding custom headers to fetch call",a),o=o&&o.headers?{...o,headers:{...o.headers,...a}}:{...o,headers:a},await e(n,o)},!window.XMLHttpRequest)return;const t=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,n,...o){this._isSameOrigin=new URL(n,window.location.origin).origin===window.location.origin,t.apply(this,[e,n,...o])},XMLHttpRequest.prototype.send=function(...e){const t=re();if(this._isSameOrigin){console.log("Adding custom headers to XMLHttpRequest call",t);for(const[e,n]of Object.entries(t))this.setRequestHeader(e,n)}n.apply(this,e)}},!1),l()?(()=>{Ce("init");const e=new ye("#payment .form-row");S.defaultHooks.addAction("payoneer.checkout.paymentMethodChanged","payoneer/shortcodeCheckout",({key:t,isValid:n,isReady:o})=>{Ce("hook paymentMethodChanged"),t||d()?(e.setActive(!0),e.setProcessing(!o),e.setValidInput(n)):e.setActive(!1)});const t=r()('<button type="button" />').text("Cancel Payment").on("click",()=>{e.setProcessingMessage(null),Pe({longId:be.getLongId()}).then(()=>window.location.reload())});document.addEventListener("DOMContentLoaded",()=>{Ce("dom ready, setup listeners"),ie(),PayoneerData.onPaymentUnsuccessfulNonce,(0,p.dispatch)(ne).setOnPaymentUnsuccessfulNonce();const n=r()("#order_review");S.defaultHooks.addFilter("payoneer.webSdk.onSdkError","payoneer/paymentCheckout",(e,t,n,o)=>{Ce("hook onSdkError",{isResolved:e,data:o});const{payOrderErrorFlag:a}=window.PayoneerData,s=new URL(document.location);return s.searchParams.set(a,!0),window.location.href=s.toString(),e}),S.defaultHooks.addFilter("payoneer.webSdk.onPaymentDeclined","payoneer/paymentCheckout",async(e,t,n,a)=>(Ce("hook onPaymentDeclined"),o(a,"declined"),!1)),S.defaultHooks.addFilter("payoneer.webSdk.onPaymentFailure","payoneer/paymentCheckout",async(e,t,n,a)=>(Ce("hook onPaymentFailure"),o(a,"failure"),!1));const o=async function(e,t){var n,o;await Pe({longId:be.getLongId(),orderKey:new URLSearchParams(window.location.search).get("key"),errorTitleToDisplay:null!==(n=e.interaction?.customerMessage?.title)&&void 0!==n?n:"Payment failed",errorTextToDisplay:null!==(o=e.interaction?.customerMessage?.text)&&void 0!==o?o:"Please try again.",paymentResult:t}),window.location.reload()};n.on("submit",o=>{if(Ce("event submit"),!d()||be.isHostedModeForced())return;o.preventDefault(),o.stopImmediatePropagation();const{isValid:a,isReady:s,key:c}=be.getActiveComponent();var i;if(s&&a)e.setProcessing(!0),(i=n,i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r().ajax({type:"POST",url:window.wc_checkout_params.ajax_url,xhrFields:{withCredentials:!0},dataType:"json",data:{action:"payoneer_order_pay",fields:i.serialize(),params:new URL(document.location).searchParams.toString()}}).always(()=>i.unblock())).then(()=>{(0,p.dispatch)(ne).pay(),(n=>{if("cards"===n)return;let o=!1;try{o=localStorage.getItem("testCancelButton")}catch(e){}o&&(setTimeout(()=>e.setProcessingMessage(t),2e3),setTimeout(()=>e.setProcessingMessage(null),57e3))})(c)}).catch(()=>{window.scrollTo(0,0),window.location.reload()});else try{u()}catch(e){console.error(e)}}),(0,p.dispatch)(ne).mountComponents()},!1)})():"1"===window?.PayoneerData?.isBlockCheckout?(console.log("Loading block checkout integration"),(()=>{let e;const t=(0,p.select)(ce.PAYMENT_STORE_KEY),n=()=>{const n=t.getActivePaymentMethod();e!==n&&((0,p.dispatch)(ne).setActivePaymentMethod(n),e=n)};(0,p.subscribe)(n,ce.PAYMENT_STORE_KEY),n()})(),Array.isArray(inpsydeGateways)?inpsydeGateways.forEach(e=>{var t;t=e,wp.hooks.addFilter(`${t}_checkout_fields`,t,e=>(e.push(we),e)),wp.hooks.addFilter("payoneer-checkout_payment_method_icons","payoneer-checkout",e=>"payoneer-checkout"===ve.getActivePaymentMethod()?[]:e)}):console.error("window.inpsydeGateways not found"),(()=>{document.addEventListener("DOMContentLoaded",()=>{wp.hooks.addFilter("payoneer.webSdk.onPaymentDeclined","payoneer/blockCheckout",(t,n,o,a)=>(e(a,"declined"),!1))},!1),document.addEventListener("DOMContentLoaded",()=>{wp.hooks.addFilter("payoneer.webSdk.onPaymentFailure","payoneer/blockCheckout",(t,n,o,a)=>(e(a,"failed"),!1))},!1);const e=function(e,t){wp.data.dispatch(ne).releaseOnHoldOrder({longId:(0,p.select)(ne).getLongId(),payoneerOrderId:(0,p.select)(ne).getOrderId(),paymentResult:t});const n=void 0===e.interaction.customerMessage?{title:"Payment failed",text:"Please, try again."}:e.interaction.customerMessage;window.sessionStorage.setItem(Te,JSON.stringify(n)),window.location.reload()}})(),function(){let e=window.sessionStorage.getItem(Te);if(e){window.sessionStorage.removeItem(Te);try{e=JSON.parse(e),e=`<b>${e.title}</b><br>`+e.text,(0,p.dispatch)("core/notices").createErrorNotice(e,{context:"wc/checkout",isDismissible:!1});let t=0;const n=20,o=setInterval(()=>{if(t++,t>=n)return clearInterval(o),console.warn("Couldn't find error message to scroll to."),!1;const e=document.querySelector(".wc-block-components-notice-banner.is-error");e&&(clearInterval(o),e.scrollIntoView({behavior:"smooth",block:"start"}))},500)}catch(e){console.error("Failed to display error message",e)}}}()):(()=>{me("init");const e=new ye("#payment");S.defaultHooks.addAction("payoneer.checkout.paymentMethodChanged","payoneer/shortcodeCheckout",({key:t,isValid:n,isReady:o})=>{me("hook paymentMethodChanged"),t||d()?(e.setActive(!0),e.setProcessing(!o),e.setValidInput(n)):e.setActive(!1)});const t=r()('<button type="button" />').text("Cancel Payment").on("click",()=>{e.setProcessingMessage(null),he({longId:Se.getLongId()}).then(()=>window.location.reload())});document.addEventListener("DOMContentLoaded",()=>{me("dom ready, setup listeners"),ie(),PayoneerData.onPaymentUnsuccessfulNonce,(0,p.dispatch)(ne).setOnPaymentUnsuccessfulNonce();const o=r()("form.checkout");S.defaultHooks.addFilter("payoneer.webSdk.onSdkError","payoneer/shortcodeCheckout",(e,t,n,o)=>(me("hook onSdkError",{isResolved:e,data:o}),(0,p.dispatch)(ne).reboot(),r()(document.body).trigger("update_checkout"),e)),S.defaultHooks.addFilter("payoneer.webSdk.onPaymentDeclined","payoneer/shortcodeCheckout",(e,t,o,a)=>(me("hook onPaymentDeclined"),n(a,"declined"),!0)),S.defaultHooks.addFilter("payoneer.webSdk.onPaymentFailure","payoneer/shortcodeCheckout",(e,t,o,a)=>(me("hook onPaymentFailure"),n(a,"failure"),!0)),r()(document.body).on("updated_checkout",()=>{me("event updated_checkout"),(0,p.dispatch)(ne).initPayoneerComponents()}),o.on("checkout_place_order",t=>{if(me("event checkout_place_order"),!d()||Se.isHostedModeForced())return;if(!e.isPaymentAllowed)return t.preventDefault(),t.stopImmediatePropagation(),me("checkout submission prevented - payment not allowed in current state"),!1;const{isValid:n,isReady:o}=Se.getActiveComponent();if(!o||!n){try{u()}catch(e){console.error(e)}return!1}return e.setProcessing(!0),!0}),o.on("checkout_place_order_success",(n,o)=>{if(me("event checkout_place_order_success"),!d()||Se.isHostedModeForced())return;const{key:a}=Se.getActiveComponent();return(0,p.dispatch)(ne).pay(),(n=>{if("cards"===n)return;let o=!1;try{o=localStorage.getItem("testCancelButton")}catch(e){}o&&(setTimeout(()=>e.setProcessingMessage(t),2e3),setTimeout(()=>e.setProcessingMessage(null),57e3))})(a),o.redirect="#payoneer-redirect",!1}),r()(document.body).on("checkout_error",(t,n)=>{n&&n.includes('data-payment-state="pending"')||(me("event checkout_error"),e.setProcessing(!1))})},!1);const n=(t,n)=>{var o,a;he({longId:Se.getLongId(),errorTitleToDisplay:null!==(o=t.interaction?.customerMessage?.title)&&void 0!==o?o:"Payment failed",errorTextToDisplay:null!==(a=t.interaction?.customerMessage?.text)&&void 0!==a?a:"Please try again.",paymentResult:n}).finally(()=>{e.setProcessing(!1),r()(document.body).trigger("update_checkout")})}})()}();
//# sourceMappingURL=payoneer-checkout.js.map